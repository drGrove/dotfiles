(function(e){e.timeago=function(h){if(h instanceof Date){return b(h)}else{if(typeof h==="string"){return b(e.timeago.parse(h))}else{return b(e.timeago.datetime(h))}}};var g=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:60000,allowFuture:false,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]}},inWords:function(m){var n=this.settings.strings;var j=n.prefixAgo;var r=n.suffixAgo;if(this.settings.allowFuture){if(m<0){j=n.prefixFromNow;r=n.suffixFromNow}m=Math.abs(m)}var p=m/1000;var h=p/60;var o=h/60;var q=o/24;var k=q/365;function i(s,v){var u=e.isFunction(s)?s(v,m):s;var w=(n.numbers&&n.numbers[v])||v;return u.replace(/%d/i,w)}var l=p<45&&i(n.seconds,Math.round(p))||p<90&&i(n.minute,1)||h<45&&i(n.minutes,Math.round(h))||h<90&&i(n.hour,1)||o<24&&i(n.hours,Math.round(o))||o<48&&i(n.day,1)||q<30&&i(n.days,Math.floor(q))||q<60&&i(n.month,1)||q<365&&i(n.months,Math.floor(q/30))||k<2&&i(n.year,1)||i(n.years,Math.floor(k));return e.trim([j,l,r].join(" "))},parse:function(i){var h=e.trim(i);h=h.replace(/\.\d\d\d+/,"");h=h.replace(/-/,"/").replace(/-/,"/");h=h.replace(/T/," ").replace(/Z/," UTC");h=h.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");return new Date(h)},datetime:function(i){var j=e(i).get(0).tagName.toLowerCase()==="time";var h=j?e(i).attr("datetime"):e(i).attr("title");return g.parse(h)}});e.fn.timeago=function(){var i=this;i.each(d);var h=g.settings;if(h.refreshMillis>0){setInterval(function(){i.each(d)},h.refreshMillis)}return i};function d(){var h=c(this);if(!isNaN(h.datetime)){e(this).text(b(h.datetime))}return this}function c(h){h=e(h);if(!h.data("timeago")){h.data("timeago",{datetime:g.datetime(h)});var i=e.trim(h.text());if(i.length>0){h.attr("title",i)}}return h.data("timeago")}function b(h){return g.inWords(f(h))}function f(h){return(new Date().getTime()-h.getTime())}document.createElement("abbr");document.createElement("time")}(jQuery));(function(b){jQuery.timeago.settings.locales={};jQuery.timeago.settings.locales.en={prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]};jQuery.timeago.settings.locales.ar=(function(){function c(f,e,d,h,g){if(f==0){return e}else{if(f==2){return d}else{if(f>=3&&f<=10){return h}else{return g}}}}return{prefixAgo:"منذ",prefixFromNow:"يتبقى",suffixAgo:null,suffixFromNow:null,seconds:function(d){return c(d,"لحظات","ثانيتين","%d ثواني","%d ثانيه")},minute:"دقيقة",minutes:function(d){return c(d,null,"دقيقتين","%d دقائق","%d دقيقة")},hour:"ساعة",hours:function(d){return c(d,null,"ساعتين","%d ساعات","%d ساعة")},day:"يوم",days:function(d){return c(d,null,"يومين","%d أيام","%d يوم")},month:"شهر",months:function(d){return c(d,null,"شهرين","%d أشهر","%d شهر")},year:"سنه",years:function(d){return c(d,null,"سنتين","%d سنوات","%d سنه")}}})();jQuery.timeago.settings.locales.bg={prefixAgo:"преди",prefixFromNow:"след",suffixAgo:null,suffixFromNow:null,seconds:"по-малко от минута",minute:"една минута",minutes:"%d минути",hour:"един час",hours:"%d часа",day:"един ден",days:"%d дни",month:"един месец",months:"%d месеца",year:"една година",years:"%d години"};jQuery.timeago.settings.locales.ca={prefixAgo:"fa",prefixFromNow:"d'aqui a",suffixAgo:null,suffixFromNow:null,seconds:"menys d'1 minut",minute:"1 minut",minutes:"uns %d minuts",hour:"1 hora",hours:"unes %d hores",day:"1 dia",days:"%d dies",month:"aproximadament un mes",months:"%d mesos",year:"aproximadament un any",years:"%d anys"};jQuery.timeago.settings.locales.cs={prefixAgo:"před",prefixFromNow:null,suffixAgo:null,suffixFromNow:null,seconds:"méně než minutou",minute:"minutou",minutes:"%d minutami",hour:"hodinou",hours:"%d hodinami",day:"1 dnem",days:"%d dny",month:"1 měsícem",months:"%d měsíci",year:"1 rokem",years:"%d roky"};jQuery.timeago.settings.locales.da={prefixAgo:"for",prefixFromNow:"om",suffixAgo:"siden",suffixFromNow:"",seconds:"mindre end et minut",minute:"ca. et minut",minutes:"%d minutter",hour:"ca. en time",hours:"ca. %d timer",day:"en dag",days:"%d dage",month:"ca. en måned",months:"%d måneder",year:"ca. et år",years:"%d år"};jQuery.timeago.settings.locales.de={prefixAgo:"vor",prefixFromNow:"in",suffixAgo:"",suffixFromNow:"",seconds:"wenigen Sekunden",minute:"etwa einer Minute",minutes:"%d Minuten",hour:"etwa einer Stunde",hours:"%d Stunden",day:"etwa einem Tag",days:"%d Tagen",month:"etwa einem Monat",months:"%d Monaten",year:"etwa einem Jahr",years:"%d Jahren"};jQuery.timeago.settings.locales.el={prefixAgo:"πριν",prefixFromNow:"σε",suffixAgo:"",suffixFromNow:"",seconds:"λιγότερο από ένα λεπτό",minute:"περίπου ένα λεπτό",minutes:"%d λεπτά",hour:"περίπου μία ώρα",hours:"περίπου %d ώρες",day:"μία μέρα",days:"%d μέρες",month:"περίπου ένα μήνα",months:"%d μήνες",year:"περίπου ένα χρόνο",years:"%d χρόνια"};jQuery.timeago.settings.locales.es={prefixAgo:"hace",prefixFromNow:"dentro de",suffixAgo:"",suffixFromNow:"",seconds:"menos de un minuto",minute:"un minuto",minutes:"unos %d minutos",hour:"una hora",hours:"%d horas",day:"un día",days:"%d días",month:"un mes",months:"%d meses",year:"un año",years:"%d años"};jQuery.timeago.settings.locales.fr={prefixAgo:"il y a",prefixFromNow:"d'ici",seconds:"moins d'une minute",minute:"une minute",minutes:"%d minutes",hour:"une heure",hours:"%d heures",day:"un jour",days:"%d jours",month:"un mois",months:"%d mois",year:"un an",years:"%d ans"};jQuery.timeago.settings.locales.he={prefixAgo:"לפני",prefixFromNow:"מעכשיו",suffixAgo:"",suffixFromNow:"",seconds:"פחות מדקה",minute:"דקה",minutes:"%d דקות",hour:"שעה",hours:"%d שעות",day:"יום",days:"%d ימים",month:"חודש",months:"%d חודשים",year:"שנה",years:"%d שנים"};jQuery.timeago.settings.locales.hu={prefixAgo:null,prefixFromNow:null,suffixAgo:null,suffixFromNow:null,seconds:"kevesebb mint egy perce",minute:"körülbelül egy perce",minutes:"%d perce",hour:"körülbelül egy órája",hours:"körülbelül %d órája",day:"körülbelül egy napja",days:"%d napja",month:"körülbelül egy hónapja",months:"%d hónapja",year:"körülbelül egy éve",years:"%d éve"};jQuery.timeago.settings.locales.hy={prefixAgo:null,prefixFromNow:null,suffixAgo:"առաջ",suffixFromNow:"հետո",seconds:"վայրկյաններ",minute:"մեկ րոպե",minutes:"%d րոպե",hour:"մեկ ժամ",hours:"%d ժամ",day:"մեկ օր",days:"%d օր",month:"մեկ ամիս",months:"%d ամիս",year:"մեկ տարի",years:"%d տարի"};jQuery.timeago.settings.locales.id={prefixAgo:null,prefixFromNow:null,suffixAgo:"yang lalu",suffixFromNow:"dari sekarang",seconds:"kurang dari semenit",minute:"sekitar satu menit",minutes:"%d menit",hour:"sekitar sejam",hours:"sekitar %d jam",day:"sehari",days:"%d hari",month:"sekitar sebulan",months:"%d tahun",year:"sekitar setahun",years:"%d tahun"};jQuery.timeago.settings.locales.it={suffixAgo:"fa",suffixFromNow:"da ora",seconds:"meno di un minuto",minute:"circa un minuto",minutes:"%d minuti",hour:"circa un'ora",hours:"circa %d ore",day:"un giorno",days:"%d giorni",month:"circa un mese",months:"%d mesi",year:"circa un anno",years:"%d anni"};jQuery.timeago.settings.locales.ja={prefixAgo:"",prefixFromNow:"今から",suffixAgo:"前",suffixFromNow:"後",seconds:"ほんの数秒",minute:"約一分",minutes:"%d 分",hour:"大体一時間",hours:"大体 %d 時間位",day:"一日",days:"%d 日ほど",month:"大体一ヶ月",months:"%d ヶ月ほど",year:"丁度一年（虎舞流ｗ）",years:"%d 年"};jQuery.timeago.settings.locales.ko={suffixAgo:"전",suffixFromNow:"후",seconds:"1분  이내",minute:"1분",minutes:"%d분",hour:"1시간",hours:"%d시간",day:"하루",days:"%d일",month:"한달",months:"%d달",year:"1년",years:"%d년"};jQuery.timeago.settings.locales.nl={suffixAgo:"geleden",suffixFromNow:"vanaf nu",seconds:"iets minder dan een minuut",minute:"ongeveer een minuut",minutes:"%d minuten",hour:"ongeveer een uur",hours:"ongeveer %d uren",day:"een dag",days:"%d dagen",month:"ongeveer een maand",months:"%d maanden",year:"ongeveer een jaar",years:"%d jaar"};jQuery.timeago.settings.locales.no={prefixAgo:"for",prefixFromNow:"om",suffixAgo:"siden",suffixFromNow:"",seconds:"mindre enn et minutt",minute:"ca. et minutt",minutes:"%d minutter",hour:"ca. en time",hours:"ca. %d timer",day:"en dag",days:"%d dager",month:"ca. en måned",months:"%d måneder",year:"ca. et år",years:"%d år"};jQuery.timeago.settings.locales.pl=(function(){function c(g,f,d){var e=g%10;if((e>1)&&(e<5)&&((g>20)||(g<10))){return f}else{return d}}return{prefixAgo:null,prefixFromNow:"za",suffixAgo:"temu",suffixFromNow:null,seconds:"mniej niż minutę",minute:"minutę",minutes:function(d){return c(d,"%d minuty","%d minut")},hour:"godzinę",hours:function(d){return c(d,"%d godziny","%d godzin")},day:"dzień",days:"%d dni",month:"miesiąc",months:function(d){return c(d,"%d miesiące","%d miesięcy")},year:"rok",years:function(d){return c(d,"%d lata","%d lat")}}})();jQuery.timeago.settings.locales.pt={suffixAgo:"atrás",suffixFromNow:"a partir de agora",seconds:"menos de um minuto",minute:"cerca de um minuto",minutes:"%d minutos",hour:"cerca de uma hora",hours:"cerca de %d horas",day:"um dia",days:"%d dias",month:"cerca de um mês",months:"%d meses",year:"cerca de um ano",years:"%d anos"};jQuery.timeago.settings.locales.ro={prefixAgo:"acum",prefixFromNow:"in timp de",suffixAgo:"",suffixFromNow:"",seconds:"mai putin de un minut",minute:"un minut",minutes:"%d minute",hour:"o ora",hours:"%d ore",day:"o zi",days:"%d zile",month:"o luna",months:"%d luni",year:"un an",years:"%d ani"};jQuery.timeago.settings.locales.ru=(function(){function c(i,h,g,d){var e=i%10;if((e==1)&&((i==1)||(i>20))){return h}else{if((e>1)&&(e<5)&&((i>20)||(i<10))){return g}else{return d}}}return{prefixAgo:null,prefixFromNow:"через",suffixAgo:"назад",suffixFromNow:null,seconds:"меньше минуты",minute:"минуту",minutes:function(d){return c(d,"%d минута","%d минуты","%d минут")},hour:"час",hours:function(d){return c(d,"%d час","%d часа","%d часов")},day:"день",days:function(d){return c(d,"%d день","%d дня","%d дней")},month:"месяц",months:function(d){return c(d,"%d месяц","%d месяца","%d месяцев")},year:"год",years:function(d){return c(d,"%d год","%d года","%d лет")}}})();jQuery.timeago.settings.locales.sv={prefixAgo:"för",prefixFromNow:"om",suffixAgo:"sedan",suffixFromNow:"",seconds:"mindre än en minut",minute:"ungefär en minut",minutes:"%d minuter",hour:"ungefär en timme",hours:"ungefär %d timmar",day:"en dag",days:"%d dagar",month:"ungefär en månad",months:"%d månader",year:"ungefär ett år",years:"%d år"};jQuery.timeago.settings.locales.tr={suffixAgo:"önce",suffixFromNow:null,seconds:"1 dakikadan",minute:"1 dakika",minutes:"%d dakika",hour:"1 saat",hours:"%d saat",day:"1 gün",days:"%d gün",month:"1 ay",months:"%d ay",year:"1 yıl",years:"%d yıl"};jQuery.timeago.settings.locales.uk=(function(){function c(i,h,g,d){var e=i%10;if((e==1)&&((i==1)||(i>20))){return h}else{if((e>1)&&(e<5)&&((i>20)||(i<10))){return g}else{return d}}}return{prefixAgo:null,prefixFromNow:"через",suffixAgo:"тому",suffixFromNow:null,seconds:"меньше хвилини",minute:"хвилина",minutes:function(d){return c(d,"%d хвилина","%d хвилини","%d хвилин")},hour:"година",hours:function(d){return c(d,"%d година","%d години","%d годин")},day:"день",days:function(d){return c(d,"%d день","%d дні","%d днів")},month:"місяць",months:function(d){return c(d,"%d місяць","%d місяці","%d місяців")},year:"рік",years:function(d){return c(d,"%d рік","%d роки","%d років")}}})();jQuery.timeago.settings.locales.zh={prefixAgo:null,prefixFromNow:"从现在开始",suffixAgo:"之前",suffixFromNow:null,seconds:"不到 1 分钟",minute:"大约 1 分钟",minutes:"%d 分钟",hour:"大约 1 小时",hours:"大约 %d 小时",day:"1 天",days:"%d 天",month:"大约 1 个月",months:"%d 月",year:"大约 1 年",years:"%d 年",numbers:[]};jQuery.timeago.settings.locales["zh-CN"]={prefixAgo:null,prefixFromNow:"从现在开始",suffixAgo:"之前",suffixFromNow:null,seconds:"不到 1 分钟",minute:"大约 1 分钟",minutes:"%d 分钟",hour:"大约 1 小时",hours:"大约 %d 小时",day:"1 天",days:"%d 天",month:"大约 1 个月",months:"%d 月",year:"大约 1 年",years:"%d 年",numbers:[]};jQuery.timeago.settings.locales["zh-TW"]={prefixAgo:null,prefixFromNow:"從現在開始",suffixAgo:"之前",suffixFromNow:null,seconds:"不到 1 分鐘",minute:"大約 1 分鐘",minutes:"%d 分鐘",hour:"大約 1 小時",hours:"大約 %d 小時",day:"1 天",days:"%d 天",month:"大約 1 個月",months:"%d 月",year:"大約 1 年",years:"%d 年",numbers:[]};if(navigator.language in jQuery.timeago.settings.locales){jQuery.timeago.settings.strings=jQuery.timeago.settings.locales[navigator.language]}}(jQuery));Database=(function(){const d=50*1024*1024;persistence.debug=false;persistence.store.websql.config(persistence,"sf","",d);const e=persistence.define("Addon",{uid:"TEXT",name:"TEXT",description:"TEXT",developper:"TEXT",url:"TEXT",link:"TEXT",free:"BOOL",app:"BOOL",published:"DATE",created:"DATE",commented:"DATE",modified:"DATE",selected:"BOOL",thumbnail:"TEXT",images:"JSON",rank:"INT",users:"INT",ratings:"INT",comments:"INT",rating:"INT",data:"JSON",variation:"JSON",options:"JSON"});e.index(["uid"],{unique:true});const c=persistence.define("History",{day:"INT",data:"JSON",created:"DATE",modified:"DATE"});e.hasMany("histories",c,"addon");const b=persistence.define("Storage",{key:"TEXT",value:"JSON",created:"DATE",updated:"DATE"});b.index(["key"],{unique:true});e.reset=function(g){var f="DROP TABLE Addon";persistence.transaction(function(h){h.executeSql(f);persistence.flush();g&&g()})};c.reset=function(g){var f="DROP TABLE History";persistence.transaction(function(h){h.executeSql(f);persistence.flush();g&&g()})};b.reset=function(g){var f="DROP TABLE Storage";persistence.transaction(function(h){h.executeSql(f);persistence.flush();g&&g()})};return{interval:24*60*60*1000,addEntityListener:function(g,i,h){var f=g.all();function j(k){k.addEventListener(i,h)}f.addEventListener("add",h._addEntityListener=function(l,k){j(k)});f.list(function(k){k.forEach(j)})},removeEntityListener:function(g,i,h){var f=g.all();f.removeEventListener("add",h._addEntityListener);f.list(function(j){j.forEach(function(k){k.removeListener(i,h)})})},Addon:e,History:c,Storage:b,init:function(f){setInterval(function(){persistence.flush(function(){persistence.clean()})},this.interval);persistence.schemaSync(function(){persistence.migrations.init(function(){if(Database.migration){for(var g in Database.migration){persistence.defineMigration(g,Database.migration[g])}}persistence.migrate(f||function(){})})})},reset:function(){persistence.reset.apply(persistence,arguments)},flush:function(){persistence.flush.apply(persistence,arguments)},add:function(){persistence.add.apply(persistence,arguments)},remove:function(){persistence.remove.apply(persistence,arguments)},clean:function(f){},migration:{}}})();persistence.migrations.Migration.prototype.addIndex=function(b,c,e){var d="CREATE IF NOT EXISTS"+(e===true?"UNIQUE":"")+" INDEX "+b+"_"+c.join("_")+" ON "+b+" ("+c.map(function(f){return"`"+f+"`"}).join(", ")+")";this.executeSql(d)};persistence.migrations.Migration.prototype.removeIndex=function(b,c){var d="DROP INDEX IF  EXISTS "+b+"_"+c.join("_");this.executeSql(d)};const ChromeWebstore=(function(){const DEBUG=chrome.settings&&chrome.settings.get("debug");const BASEURI="https://chrome.google.com";const PATH="/webstore/ajax/";const MAX_DASHBOARD_PAGES=10;const QueryString={parse:function(s){var o={};s.split("&").forEach(function(p){var a=p.split("=");o[decodeURIComponent(a[0])]=decodeURIComponent(a[1])});return o},stringify:function(o){return Object.keys(o).map(function(key){return[encodeURIComponent(key),encodeURIComponent(o[key])].join("=")}).join("&")}};function parseExtension(i){return{uid:i[0],name:i[1],developper:i[2],site:i[35],thumbnail:i[3],images:{large:i[5],medium:i[4],small:i[25]},app:i[9].indexOf("app")==0,free:i[28].split("/")[1]=="free",description:i[6],link:i[11],url:BASEURI+"/webstore/detail/"+i[0],category:i[9],rating:i[12],users:parseInt(i[23].replace(/[^\d]/g,"")),ratings:parseInt(i[22])}}function wrapFunction(f){return(typeof f=="function")?f:function(){}}return{get t(){return localStorage.ChromeWebStoreApiKey},set t(value){return localStorage.ChromeWebStoreApiKey=value},get version(){return localStorage.ChromeWebStoreApiVersion},set version(value){return localStorage.ChromeWebStoreApiVersion=value},getToken:function(callback){$.post([BASEURI,"/reviews/json/token"].join(""),function(data){callback(data.channelHeader.token)},"json")},updateVersion:function(callback){const _this=this;callback=wrapFunction(callback);$.get([BASEURI,"webstore"].join("/"),function(data){var matches=data.match(/webstore\/static\/(\d+)\/wall\/js\//);var version=matches?_this.version=matches[1]:null;callback(version)})},rate:function(addon,rating,callback){callback=wrapFunction(callback);this.getToken(function(token){var data="req="+JSON.stringify({appId:94,version:"111110",hl:"fr",specs:[{type:"RatingPicker",url:encodeURIComponent(addon.link),groups:"chrome_webstore",id:"2",rating:rating,event:"writeAnnotation"}],internedKeys:[],internedValues:[]})+"&token="+token;DEBUG&&console.log("ChromeWebstore.rate()",data);var xhr=new XMLHttpRequest();xhr.open("post",[BASEURI,"/reviews/components"].join(""));xhr.send(data);return;$.ajax({type:"post",url:[BASEURI,"/reviews/components"].join(""),data:data,success:function(data){DEBUG&&console.log("ChromeWebstore post /reviews/components success! data:",data);callback()}})})},getStatus:function(callback){callback=wrapFunction(callback);var url=[BASEURI,"/reviews/json/search"].join("");var data="req="+JSON.stringify({searchSpecs:[{entities:[]}],applicationId:94});return $.post(url,data,function(data){callback(data.user)},"json").error(function(a){console.error(a);callback(null)})},getRatings:function(id,callback){callback=wrapFunction(callback);var url=[BASEURI,"/reviews/json/lookup"].join("");var data="req="+JSON.stringify({entities:[{url:"http://chrome.google.com/extensions/permalink?id="+id,includeAggregateInfo:true},{url:"http://chrome.google.com/webstore/permalink?id="+id,includeAggregateInfo:true}],applicationId:94});return $.post(url,data,function(data){try{var o=data.annotations[0].aggregateInfo;var rating={average:o.averageRating,count:o.numRatings,ratings:o.starRatings};DEBUG&&console.log("ChromeWebstore.post rating:",rating);callback(rating)}catch(err){callback(null)}},"json").error(function(a){console.error(a);callback(null)})},getComments2:function(id,callback){callback=wrapFunction(callback);var url=[BASEURI,"/reviews/json/search"].join("");var data="req="+JSON.stringify({searchSpecs:[{entities:[{url:"http://chrome.google.com/webstore/permalink?id="+id,includeAggregateInfo:true}],groups:["chrome_webstore"],matchExtraGroups:true,sortBy:"lastModificationDate",startIndex:0,numResults:100,includeNickNames:true},{entities:[{url:"http://chrome.google.com/extensions/permalink?id="+id,includeAggregateInfo:true}],groups:["chrome_webstore"],matchExtraGroups:true,sortBy:"lastModificationDate",startIndex:0,numResults:100,includeNickNames:true}],applicationId:94});return $.post(url,data,function(data){try{var comments={items:(data.searchResults[0].annotations||[]).concat(data.searchResults[1].annotations||[]).map(function(o){return{date:new Date(o.timestamp*1000),description:o.comment,user:{name:o.entity.displayName,nickname:o.entity.nickname,url:o.entity.profileUrl,rating:o.entity.rating,thumbnail:o.entity.photoUrl}}}).filter(function(comment){return comment.description}),count:data.searchResults[0].numAnnotations+data.searchResults[1].numAnnotations};callback(comments)}catch(err){console.error(err);callback(null)}},"json").error(function(a){console.error(a);callback(null)})},getComments:function(id,callback){const _this=this;callback=wrapFunction(callback);var url=[BASEURI,"/reviews/components"].join("");var data={appId:94,hl:"fr",js:false,specs:[{type:"CommentThread",url:encodeURIComponent("http://chrome.google.com/webstore/permalink?id="+id),groups:"chrome_webstore",sortby:"lastModificationDate",startindex:"0",numresults:"100",id:"1"},{type:"CommentThread",url:encodeURIComponent("http://chrome.google.com/extensions/permalink?id="+id),groups:"chrome_webstore",sortby:"lastModificationDate",startindex:"0",numresults:"100",id:"2"}],internedKeys:[],internedValues:[]};return $.ajax({type:"post",url:url,data:"req="+JSON.stringify(data),complete:function(xhr){try{a=eval(xhr.responseText.replace("window.google.annotations2.component.load","[].concat"));var comments={count:a[0][1].results.numAnnotations+a[0][2].results.numAnnotations,items:a[0][1].results.annotations.concat(a[0][2].results.annotations).map(function(item){return{description:item.comment,date:new Date(item.timestamp*1000),rating:item.starRating,user:{name:item.entity.displayName,nickname:item.entity.nickname,url:item.entity.profileUrl,thumbnail:item.entity.authorPhotoUrl}}})};callback(comments)}catch(err){console.error(err);callback(null)}}})},getDetail:function(id){var callback=wrapFunction(arguments[arguments.length-1]);var update=typeof arguments[1]=="boolean"?arguments[1]:true;const _this=this;var url=[[BASEURI,PATH,"detail"].join(""),QueryString.stringify({pv:this.version,id:id})].join("?");return $.post(url,function(data){var a=eval(data.substr(6));var o=a[1][1];var detail=parseExtension(a[1][1][0]);detail.manifest=JSON.parse(a[1][1][9][0]);callback(detail)},"text").error(function(xhr){console.warn("error while loading",url,xhr.status,xhr.statusText,xhr);if([400,441].indexOf(xhr.status)!=-1&&update){_this.updateVersion(function(){_this.getDetail(id,false,callback)})}else{callback(null)}})},getDashboard:function(callback){callback=wrapFunction(callback);var url=BASEURI+"/webstore/developer/dashboard";var page=1;var addons=[];function getPage(){$.get(url,{page:page},function(data){if(data.indexOf("KXT6sEPtukXSillV5jIndLe8GNGJ9_VDJcTW10mmOWU")==-1){return callback(null)}var splited=data.split('<div class="g-section cx-box cx-dev-dash-item">').slice(1);var pageAddons=splited.map(function(s){var $item=$(s.split('<table id="cx-dev-dash-confirm"')[0].replace(/src=/g,"_src="));var $a=$item.find(".cx-title h2 a");return $a.size()==1?{name:$a.html(),uid:$a.attr("href").split("/")[3]}:null}).filter(function(addon){return addon});addons=addons.concat(pageAddons);if(addons.length>0&&page++<MAX_DASHBOARD_PAGES){getPage()}else{callback(addons)}}).error(function(){callback(addons)})}getPage()},_search:function(text){const _this=this;var callback=wrapFunction(arguments[arguments.length-1]);var update=typeof arguments[1]=="boolean"?arguments[1]:true;var url=[[BASEURI,PATH,"item"].join(""),QueryString.stringify({searchTerm:text,pv:this.version,index:0,count:100,category:"home",sortBy:1})].join("?");return $.post(url,{t:this.t},function(data){var a=eval(data.substr(6));var results=a[1][1].map(parseExtension);wrapFunction(callback)(results)},"text").error(function(xhr){if(xhr.status>0){console.warn("error while loading",url,xhr.status,xhr.statusText,xhr)}if([400,441].indexOf(xhr.status)!=-1&&update){_this.updateVersion(function(){_this.getDetail(id,false,callback)})}else{callback(null)}})},search:function(options){const _this=this;var callback=wrapFunction(arguments[arguments.length-1]);var update=typeof arguments[1]=="boolean"?arguments[1]:true;var url=[[BASEURI,PATH,"item"].join(""),QueryString.stringify($.extend({},{sortBy:1,pv:this.version,index:0,count:200,category:"home"},options))].join("?");return $.post(url,function(data){var a=eval(data.substr(6));var results=a[1][1].map(parseExtension);wrapFunction(callback)(results)},"text").error(function(xhr){if(xhr.status>0){console.warn("error while loading",url,xhr.status,xhr.statusText,xhr,update)}if([400,441].indexOf(xhr.status)!=-1&&update){_this.updateVersion(function(){_this.search(options,false,callback)})}else{callback(null)}})},getPopular:function getPopular(start){const _this=this;var callback=wrapFunction(arguments[arguments.length-1]);var update=typeof arguments[1]=="boolean"?arguments[1]:true;var url=[[BASEURI,PATH,"item"].join(""),QueryString.stringify({pv:this.version,index:0,token:(start||0)+",0",count:200,category:"popular",sortBy:1})].join("?");return $.post(url,function(data){var a=eval(data.substr(6));var results=a[1][1].map(parseExtension);wrapFunction(callback)(results)},"text").error(function(xhr){console.warn("error while loading",url,xhr.status,xhr.statusText,xhr);if(xhr.status==441&&update){_this.updateVersion(function(){_this.getPopular(id,false,callback)})}else{callback(null)}})},getTop:function(max,callback){const _this=this;var result=[];function _getTop(r){result=result.concat(r);var start=result.length;DEBUG&&console.log("ChromeWebstore.getTop(r): ",start,"/",max,r&&r.length);if(start>max||(result.length>0&&r.length==0)){var sortedAddons=result.sort(function(a,b){return a.users==b.users?b.ratings-a.ratings:b.users-a.users});sortedAddons.forEach(function(addon,index){addon.rank=index+1});callback(sortedAddons)}else{_this.getPopular(start,_getTop)}}_getTop([])}}})();const Backlink={getAll:function(d,f){var c={},e=0;function b(){if(++e==3){f(c)}}this.getTwitterCount(d,function(g){c.twitter=g;b()});this.getFacebookLikeCount(d,function(g){c.facebook=g;b()});this.getGooglePlusCount(d,function(g){c.plusone=g;b()})},getTwitterCount:function(b,d){const c="http://urls.api.twitter.com/1/urls/count.json";$.get(c,{url:b,_:(new Date()).getTime()},function(e){d(e.count)}).error(function(){d(null)})},getFacebookLikeCount:function(b,d){const c="https://www.facebook.com/plugins/like.php";$.get(c,{action:"like",href:b,_:(new Date()).getTime()},function(e){var f=/<span\s+class="connect_widget_not_connected_text">([^<>]+)</.test(e)&&RegExp.$1;d(/\d/.test(f)?parseInt(f.replace(/\s+/g,"")):0)}).error(function(){d(null)})},getGooglePlusCount:function(c,f){const e="https://clients6.google.com/rpc?key=AIzaSyCKSbrvQasunBoV16zDH9R33D88CeLr9gQ";const b=[{method:"pos.plusones.get",id:"p",params:{nolog:true,id:c,source:"widget",userId:"@viewer",groupId:"@self"},jsonrpc:"2.0",key:"p",apiVersion:"v1"}];var d=null;$.ajax({type:"POST",url:e,data:JSON.stringify(b),complete:function(){f(d)},success:function(h){try{d=h[0].result.metadata.globalCounts.count}catch(g){console.log("getGooglePlusCount:",g,h);d=null}},contentType:"application/json"})}};const Stats=(function(){const c=chrome.debug;const b="catalog";function d(g){return(typeof g=="function")?g:function(){}}var e;return{get updated(){return chrome.settings.get("updated")},set updated(f){return chrome.settings.set("updated",new Date(f))},add:function(f,h){const g=this;Database.Addon.findBy("uid",f.uid,function(i){if(!i){var i=new Database.Addon(f);i.created=new Date();Database.add(i)}i.selected=true;g.update(i,function(){Database.flush(function(){h(i)})})})},remove:function(g,h){h=d(h);if(g instanceof Database.Addon){Database.remove(g);Database.flush(function(){h(g)})}else{var f=typeof g=="string"?g:g.uid;Database.Addon.findBy("uid",f,function(i){Database.remove(i);Database.flush(function(){h(i)})})}},unselect:function(g,h){h=d(h);if(g instanceof Database.Addon){g.selected=false;Database.flush(function(){h(g)})}else{var f=typeof g=="string"?g:g.uid;Database.Addon.findBy("uid",f,function(i){console.log("removing",i);i.selected=false;Database.flush(function(){h(i)})})}},list:function(g,h){h=d(arguments[arguments.length-1]);if(typeof arguments[0]!="object"){g={}}var f=Database.Addon.all();if(g.filter){f=f.filter("selected","=",g.filter.selected)}if(g.order){f=f.order(g.order[0],g.order[1])}f.list(function(i){h(i)})},update:function(f,k,m){const l=this;var i=(typeof arguments[1]=="object")?k:null;const j=24*60*60*1000;m=d(arguments[arguments.length-1]);var g=Math.floor((new Date()).getTime()/j);function h(n){l.getCatalog(function(o){ChromeWebstore.getComments(f.uid,function(p){f.histories.filter("day","=",g).list(function(q){var r=q[0];if(!r){r=new Database.History({day:g,created:new Date(),modified:new Date(),data:{}});f.histories.add(r)}if(!f.data){f.data={}}if(!f.variation){f.variation={}}Backlink.getAll(f.url,function(s){$.extend(r.data,{users:n.users,rating:n.rating,ratings:n.ratings,comments:p?p.count:0,commented:p&&p.items[0]?p.items[0].date:null},s);if(o&&f.uid in o){r.data.rank=o[f.uid].rank}$.extend(f,r.data);$.extend(f.data,s);f.markDirty("data");r.markDirty("data");f.histories.order("day",false).limit(2).list(function(u){var w=u[0],v=u[1];if(w&&!v){v=new Database.History({day:g-1,created:new Date(),modified:new Date(),data:w.data});f.histories.add(v)}if(w&&v){Object.keys(w.data).filter(function(x){return x!="commented"}).forEach(function(x){f.variation[x]=w.data[x]-v.data[x]});f.markDirty("variation");if(f.variation.users){l.webstoreAddons=[]}}m(r)})})})})})}if(i){h(i)}else{ChromeWebstore.getDetail(f.uid,function(n){if(!n){console.warn("no detail for ",f.name,f.uid);m(null)}else{h(n)}})}},updateSelected:function(g){g=d(g);const f=this;Database.Addon.all().filter("selected","=",true).list(function(h){requestCount=h.length;if(requestCount==0){return g(h)}h.forEach(function(i,j){f.update(i,function(){if(--requestCount==0){Database.flush(function(){f.updated=new Date();g(h)})}})})})},updateAllAddons:function(f,i){const h=this;i=d(i);var g={};Database.Addon.all().list(function(j){j.forEach(function(k){g[k.uid]=k});ChromeWebstore.getTop(f,function(k){h.webstoreAddons=k;var l=[];k.forEach(function(m){if(!(m.uid in g)){addonEntity=new Database.Addon(m);addonEntity.created=new Date();addonEntity.variation={};addonEntity.data={};Database.add(addonEntity)}else{addonEntity=g[m.uid];["users","ratings","rank","comments"].forEach(function(n){addonEntity[n]=m[n]})}l.push(addonEntity);["users","ratings","rank","comments"].forEach(function(n){if(m[n]&&addonEntity[n]!=m[n]){addonEntity.variation[n]=m[n]-addonEntity.data[n];addonEntity.markDirty("variation")}})});Database.flush(function(){i(l)})})})},updateRank:function(f,i){c&&console.log("updateRank",f);const h=this;i=d(i);var g={};Database.Addon.all().list(function(k){k.forEach(function(l){g[l.uid]=l});function j(l){c&&console.log("updateRank _update");h.webstoreAddons=l;var m=[];l.filter(function(n){return n.uid in g}).forEach(function(o){var n=g[o.uid];c&&console.log("\t",o.name,n.rank,o.rank);if(n.rank>0&&n.rank!=o.rank){n.variation.rank=o.rank-n.rank;n.markDirty("variation")}n.rank=o.rank;m.push(n)});Database.flush(function(){Object.keys(g).forEach(function(n){delete (g[n])});i(m)})}if(h.webstoreAddons.length>0){j(h.webstoreAddons)}else{ChromeWebstore.getTop(f,j)}})},getCatalog:function(g){const f=this;g=d(g);if(e){g(e&&e.value,e)}else{Database.Storage.findBy("key",b,function(h){e=h;g(e&&e.value,e)})}},updateCatalog:function(f,h){c&&console.log("updateCatalog",f);const g=this;h=d(h);ChromeWebstore.getTop(f,function(i){var j={};i.forEach(function(k){j[k.uid]={users:k.users,rank:k.rank,ratings:k.ratings,rating:k.rating}});g.getCatalog(function(l,k){if(!k){k=new Database.Storage({key:b,created:new Date(),updated:new Date(),value:j});Database.add(k)}else{k.updated=new Date();k.value=j;k.markDirty("value")}e=k;Database.flush(function(){h(e)})})})}}})();function wrapCallback(b){return(typeof b=="function")?b:function(){}}const UI=(function(){const Stats=chrome.extension.getBackgroundPage().Stats;const DEBUG=chrome.debug;const CHART_TYPE_DATE=true;const GOOGLE_TRANSLATE_URL="http://translate.google.com/translate_a/t";function drawHistoryChart(data,title,container){var historyDataTable=new google.visualization.DataTable();historyDataTable.addColumn(CHART_TYPE_DATE?"date":"string","Date");historyDataTable.addColumn("number",title);historyDataTable.addRows(data.length);data.forEach(function(item,i){historyDataTable.setCell(i,0,CHART_TYPE_DATE?new Date(item.date):new Date(item.date).toISOString().split("T")[0]);historyDataTable.setCell(i,1,item.value)});var chart=new google.visualization.LineChart(container);chart.draw(historyDataTable,{strictFirstColumnType:false,legend:{position:"none"},title:title})}return{get loading(){return $(document.body).is(".loading")},set loading(val){return $(document.body).toggleClass("loading",!!val)},get country(){return"fr"},get $chart(){return $("#chart")},get $comments(){return $("#comments")},get $addons(){return $("#addons")},get $form(){return $("#form-search")},update:function(){const _this=this;_this.loading=true;_this.index=0;Stats.updateSelected(function(){_this.refresh();_this.loading=false;location.reload()})},init:function(){const _this=this;var searchText;this.paginator=Paginator(this.$addons.find("[name=entries]").get(0),{limit:25,bottomPixels:200,scrollable:true,get queryCollection(){var queryCollection=searchText?Database.Addon.search(searchText+"*"):Database.Addon.all();if($("[name=source]:radio:checked").val()=="selection"){queryCollection=queryCollection.filter("selected","=",true)}return queryCollection},counter:function(callback){return this.queryCollection.count(wrapCallback(callback))},manager:function(skip,limit,callback){var queryCollection=this.queryCollection;if(!searchText){queryCollection=queryCollection.order("name",true)}return queryCollection.limit(limit).skip(skip).list(wrapCallback(callback))}});$("[name=source]:radio").change(function(event){chrome.settings.set("source",$("[name=source]:radio:checked").val());_this.refresh()}).filter("[value="+chrome.settings.get("source")+"]").each(function(){this.checked=true});var $entities=this.$form.find(".addons").hide();function importAddons(addons){var count=0;console.log("importing addons",addons,count);if(addons.length==0){_this.loading=false}addons.forEach(function(addon,index,a){ChromeWebstore.getDetail(addon.uid,function(addon){function finish(){if(++count==a.length){_this.refresh();_this.update();_this.loading=false}}if(addon){Stats.add(addon,finish)}else{finish()}})})}$("[name=import-own]").click(function(){_this.loading=true;chrome.management.getAll(function(addons){importAddons(addons.filter(function(addon){return addon.updateUrl}).map(function(addon){return $entities.extend(addon,{uid:addon.id})}))})});$("[name=import-webstore]").click(function(){_this.loading=true;ChromeWebstore.getDashboard(function(addons){if(!addons){_this.loading=false;if(confirm("you are not connected to any Google account. Do you want to connect ?")){chrome.tabs.create({url:"https://accounts.google.com/ServiceLogin"})}}else{importAddons(addons)}})});$("[name=update-now]").click(function(){_this.update()});$entities.find(".addon").live("click",function(){var $addon=$(this).closest("[name=addon]");var addon=$addon.data("addon");_this.loading=true;Stats.add(addon,function(){_this.refresh();_this.loading=false});$entities.hide();return false});var request;this.$form.submit(function(){var text=$(this).find("input:[name=query]").val();if(text.length<2){return false}_this.$form.removeClass("error");_this.$form.addClass("searching");if(request){request.abort()}request=ChromeWebstore.search({searchTerm:text},function(addons){if(addons){if(addons.length==0){_this.$form.addClass("error")}$entities.jsTemplate({addon:addons}).show();_this.$form.removeClass("searching")}});return false}).find("[name=query]").keyup(function(){_this.$form.submit()});$(window).click(function(){$entities.hide();_this.$chart.hide().html("");_this.$comments.hide();_this.$form.removeClass("error","loading")});this.$chart.mouseleave(function(){_this.$chart.hide().html("")});this.$comments.mouseleave(function(){_this.$comments.hide()});var timeoutId;var currentCommentAddonId;this.$addons.find("[info]:not([null=true])").live("mouseover",function(event){if(this!=event.target){return}var target=this;var $addon=$(this).closest("[name=addon]");var addon=$addon.data("addon");var property=$(this).attr("history");$(this).mouseleave(function(){clearTimeout(timeoutId)});clearTimeout(timeoutId);timeoutId=setTimeout(function(){clearTimeout(timeoutId);if(_this.$comments.is(":visible")&&addon.uid==currentCommentAddonId){return}currentCommentAddonId=addon.uid;_this.$chart.hide();_this.$comments.hide();ChromeWebstore.getComments(addon.uid,function(commentsInfo){var position=$(target).offset();_this.$comments.css({top:$addon.offset().top+$addon.height(),left:event.clientX-Math.round(_this.$chart.width()/2)}).show();_this.$comments.jsTemplate({comment:commentsInfo.items}).show()})},chrome.settings.get("hover"))});this.$addons.find("[history]:not([null=true])").live("mouseover",function(event){var target=this;var $addon=$(this).closest("[name=addon]");var addon=$addon.data("addon");var property=$(this).attr("history");$(this).mouseleave(function(){clearTimeout(timeoutId)});clearTimeout(timeoutId);timeoutId=setTimeout(function(){clearTimeout(timeoutId);_this.$chart.hide();_this.$comments.hide();addon.histories.order("day",true).list(function(histories){var data=histories.map(function(history){return{date:new Date(history.day*24*60*60*1000),value:history.data[property]}});var position=$(target).offset();_this.$chart.css({top:$addon.offset().top+$addon.height(),left:event.clientX-Math.round(_this.$chart.width()/2)}).show();drawHistoryChart(data,property,_this.$chart.get(0))})},chrome.settings.get("hover"));return false});this.$addons.find("[name=add],[name=remove]").live("click",function(event){var $addon=$(this).closest("[name=addon]");var addon=$addon.data("addon");$addon.addClass("loading");Stats[$(this).attr("name")](addon,function(entity){_this.refresh();$addon.jsTemplate({entry:entity}).removeClass("loading")});return false});Database.Addon.all().count(function(count){if(count==0){$("#panel-start").show();$(document.body).click(function(){$("#panel-start").hide()})}});$("[rel=translate]").live("click",function(){$description=$(this).closest("[name=comment]").find("[name=description]");var text=$description.text();$.get(GOOGLE_TRANSLATE_URL,{client:"t",sl:"auto",tl:navigator.language,text:text},function(data){var translation=eval(data)[0][0][0];$description.html(translation.replace(/\n/g,"<br>"))});$(this).hide();return false})},refresh:function(){const _this=this;this.paginator.index=0;this.paginator.refresh(function(entities){var ratings=entities.filter(function(entity){return entity.rating>0}).map(function(entity){return entity.rating});function getTotal(property){properties=property.split(".");return entities.length>0?entities.map(function(entity){return(properties.length==1?(entity[properties[0]]):(entity[properties[0]]&&entity[properties[0]][properties[1]]))||0}).reduce(function(previousValue,currentValue,index,array){return previousValue+currentValue}):0}var total={ratings:ratings.length>0?ratings.reduce(function(previousValue,currentValue,index,array){return previousValue+currentValue})/ratings.length:0};["users","comments","data.plusone","data.twitter","data.facebook"].forEach(function(property){total[property.split(".").pop()]=getTotal(property)});_this.$addons.find("[name=total]").jsTemplate({total:total,});ChromeWebstore.getStatus(function(user){$("[name=addon]").each(function(){var addon=$(this).data("addon");$(this).find("a[name=edit]").toggle(addon&&addon.developper==user.displayName)})})})}}})();const Formater={toInteger:function(b){return b.toString().split("").reverse().join("").replace(/(\d\d\d)(?=\d)/g,"$1,").split("").reverse().join("")}};