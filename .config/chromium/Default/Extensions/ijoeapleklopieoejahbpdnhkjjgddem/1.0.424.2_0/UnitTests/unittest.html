<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <!--
    
    /*************************************************************************
    *
    * ADOBE CONFIDENTIAL
    * ___________________
    *
    *  Copyright 2011 Adobe Systems Incorporated
    *  All Rights Reserved.
    *
    * NOTICE:  All information contained herein is, and remains
    * the property of Adobe Systems Incorporated and its suppliers,
    * if any.  The intellectual and technical concepts contained
    * herein are proprietary to Adobe Systems Incorporated and its
    * suppliers and are protected by trade secret or copyright law.
    * Dissemination of this information or reproduction of this material
    * is strictly forbidden unless prior written permission is obtained
    * from Adobe Systems Incorporated.
    **************************************************************************/
    
    AdobePatentID="2121US01"
    AdobePatentID="2122US01"    
    -->
    <head>
    <title>Adobe Shadow Chrome Extension - Unit Test Driver</title>
    <link rel="stylesheet" href="http://code.jquery.com/qunit/git/qunit.css" type="text/css" media="screen" />
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/qunit/git/qunit.js"></script>
    <script language="JavaScript">
    $(document).ready(function () {
        // Call EVERYTHING through the Background Page.
        // we'll call it bg for short
        var bg = chrome.extension.getBackgroundPage();
        var UUID = bg.Connection._uuid;

        module("skylab.js Smoke Test");

        
        test("Controller Follow Mode Toggle", function () {
            var followMode = bg.SkyLabController.getFollowMode();
            var followModeSwitch = {
                "on" : "off",
                "off" : "on"
            };

            ok(true, "Initial State Is " + followMode);

            bg.SkyLabController.setFollowMode(followModeSwitch[followMode]);

            equal(
                    bg.SkyLabController.getFollowMode(),
                    followModeSwitch[followMode],
                    "Follow Mode Is Toggled"
            );

            bg.SkyLabController.setFollowMode(followMode);

            equal(
                    bg.SkyLabController.getFollowMode(),
                    followMode,
                    "Follow Mode Is Now Back To Initial State"
            );
        })
/*      Uncomment Pairing Tests when WebKit bugs have been fixed
        test("Paring Note Initial State Is Empty", function () {
            equal(
                    bg.SkyLabView._pairingnote,
                    "",
                    "Pairing Note Is Empty"
            );
        });
        
        test("Paring Note Is Not Empty When Request Passcode Is Called", function () {
            bg.SkyLabController.showRequestPasscode();
            notEqual(
                        bg.SkyLabView._pairingnote,
                        "",
                        "Pairing Note Is Not Empty"
            );
        });
        
        test("Paring Note Is Empty After Passcode Dialogue Is Dismissed", function () {
            bg.SkyLabController.dismissRequestPasscode();
            equal(
                    bg.SkyLabView._pairingnote,
                    "",
                    "Pairing Note Is Empty"
            );
        });
*/        
        test ("Connection Format - Inventory", function () {
            var massaged = JSON.parse(bg.Connection._formatInventory("connected"));
            delete massaged.options.random;
            equal(
                    JSON.stringify(massaged),
                    "{\"action\":\"inventory\",\"source\":\"" + UUID + "\",\"options\":{\"subaction\":\"listresources\",\"type\":\"device\",\"status\":\"connected\"}}",
                    "Formatting An Inventory Request"
            );
        });
        
        test ("Connection Format - Eject", function () {
            var massaged = JSON.parse(bg.Connection._formatEject(["EjectDeviceId01"]));
            delete massaged.options.random;
            equal(
                    JSON.stringify(massaged),
                    "{\"action\":\"inventory\",\"source\":\"" + UUID + "\",\"options\":{\"subaction\":\"eject_device\",\"deviceids\":[\"EjectDeviceId01\"]}}",
                    "Formatting An Eject Request"
            );
        });
        
        test ("Connection Format - Forget", function () {
            var massaged = JSON.parse(bg.Connection._formatForget("ForgetDeviceId02"));
            delete massaged.options.random;
            equal(
                    JSON.stringify(massaged),
                    "{\"action\":\"inventory\",\"source\":\"" + UUID + "\",\"options\":{\"subaction\":\"forget_device\",\"deviceids\":[\"ForgetDeviceId02\"]}}",
                    "Formatting An Forget Request"
            );
        });
        
        test ("Connection Format - Passcode", function () {
            var massaged = JSON.parse(bg.Connection._formatPasscode("MySafePasscode", "PasscodeDeviceId03"));
            delete massaged.options.random;
            equal(
                    JSON.stringify(massaged),
                    "{\"action\":\"inventory\",\"source\":\"" + UUID + "\",\"options\":{\"subaction\":\"passcode_response\",\"id\":\"PasscodeDeviceId03\",\"passcode\":\"MySafePasscode\"}}",
                    "Formatting An Passcode Request"
            );
        });
        
        test ("Connection Format - Connect", function () {
            var massaged = JSON.parse(bg.Connection._formatConnect(bg.Connection.rand1));
            delete massaged.options.random;
            delete massaged.options.challenge;
            equal(
                    JSON.stringify(massaged),
                    "{\"action\":\"connect\",\"source\":\"" + UUID + "\",\"options\":{\"id\":\"" + UUID + "\",\"name\":\"Chrome Extension\",\"type\":\"administrator\"}}",
                    "Formatting An Connect Request"
            );
        });
        
        test ("Connection Format - First Pair", function () {
            var massaged = JSON.parse(bg.Connection._formatPairFirst());
            delete massaged.options.random;
            equal(
                    JSON.stringify(massaged),
                    "{\"action\":\"pair\",\"source\":\"" + UUID + "\",\"options\":{\"id\":\"" + UUID + "\",\"name\":\"Chrome Extension\",\"type\":\"administrator\",\"passcode\":\"" + bg.Connection.keyHex + "\",\"rand\":\"" + bg.Connection.rand1 + "\"}}",
                    "Formatting An Pair Request"
            );
        });
        
        test ("Connection Format - Subsequent Pair", function () {
            var massaged = JSON.parse(bg.Connection._formatPair());
            delete massaged.options.random;
            equal(
                    JSON.stringify(massaged),
                    "{\"action\":\"pair\",\"source\":\"" + UUID + "\",\"options\":{\"id\":\"" + UUID + "\",\"name\":\"Chrome Extension\",\"type\":\"administrator\",\"rand\":\"" + bg.Connection.rand1 + "\"}}",
                    "Formatting An Pair Request"
            );
        });
        
        test ("Connection Format - Browse", function () {
            var massaged = JSON.parse(bg.Connection._formatBrowse("http://www.adobe.com", []));
            delete massaged.options.random;
            equal(
                    JSON.stringify(massaged),
                    "{\"action\":\"publish\",\"source\":\"" + UUID + "\",\"options\":{\"message\":{\"action\":\"browser_navigate\",\"source\":\"" + UUID + "\",\"options\":{\"url\":\"http://www.adobe.com\"}},\"destinations\":[]}}",
                    "Formatting An Browse Request"
            );
        });
        
        test ("Connection Format - Screenshot", function () {
            var massaged = JSON.parse(bg.Connection._formatScreenshot("cced51d0-8592-11e1-b0c4-0800200c9a66", []));
            delete massaged.options.random;
            equal(
                    JSON.stringify(massaged),
                    "{\"action\":\"publish\",\"source\":\"" + UUID + "\",\"options\":{\"message\":{\"action\":\"screenshot_request\",\"source\":\"" + UUID + "\",\"options\":{\"request_id\":\"cced51d0-8592-11e1-b0c4-0800200c9a66\"}},\"destinations\":[]}}",
                    "Formatting An Screenshot Request"
            );
        });

        test ("Connection Format - Cancel Screenshot", function () {
            var massaged = JSON.parse(bg.Connection._formatCancelScreenshot("cced51d0-8592-11e1-b0c4-0800200c9a66", []));
            delete massaged.options.random;
            equal(
                    JSON.stringify(massaged),
                    "{\"action\":\"publish\",\"source\":\"" + UUID + "\",\"options\":{\"message\":{\"action\":\"transfer_cancel\",\"source\":\"" + UUID + "\",\"options\":{\"request_id\":\"cced51d0-8592-11e1-b0c4-0800200c9a66\"}},\"destinations\":[]}}",
                    "Formatting An Cancel Screenshot Request"
            );
        });
        
        test ("Connection Format - Force Refresh", function () {
            var massaged = JSON.parse(bg.Connection._formatForcerefresh("cced51d0-8592-11e1-b0c4-0800200c9a66", []));
            delete massaged.options.random;
            equal(
                    JSON.stringify(massaged),
                    "{\"action\":\"publish\",\"source\":\"" + UUID + "\",\"options\":{\"message\":{\"action\":\"force_refresh\",\"source\":\"" + UUID + "\",\"options\":{\"request_id\":\"cced51d0-8592-11e1-b0c4-0800200c9a66\"}},\"destinations\":[]}}",
                    "Formatting An Force Refresh Request"
            );
        });

        test ("StorageManager Get Port", function () {
            equal(bg.StorageManager.get("port"), "7682", "Port is 7682 and I can see it.");
        })
    });
    </script>
</head>
<body>
<body>
    <h1 id="qunit-header">Adobe&#00AE; Shadow QUnit Tests</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar"></div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    <div id="qunit-fixture">test markup, will be hidden</div>
</body></body>
</html>
